(()=>{var a=firebase.functions().httpsCallable("loginToXCStats"),b=document.querySelector("#xu-cl-xcstats-loginButton"),c=document.querySelector("#xu-cl-xcstats-loginForm"),d=document.querySelector("#xu-cl-xcstats-email"),e=document.querySelector("#xu-cl-xcstats-password"),f=document.querySelector("#xu-cl-xcstats-submitButton"),g=document.querySelector("#xu-cl-xcstats-loginError"),h=document.querySelector("#xu-cl-strava-loginButton");b.onclick=()=>{b.disabled=!0,c.classList.remove("d-none")},c.onsubmit=b=>{b.preventDefault(),g.classList.add("d-none"),f.disabled=!0;var i={email:d.value,password:e.value};a(i).then(a=>{console.log(a),c.classList.add("d-none"),h.disabled=!1}).catch(a=>{console.error(a),g.innerText="Login error",g.classList.remove("d-none"),f.disabled=!1})}})(),(()=>{var a=firebase.functions().httpsCallable("getStravaLoginURL"),b=document.querySelector("#xu-cl-strava-loginButton");b.onclick=()=>{b.disabled=!0,firebase.auth().currentUser.getIdToken(!0).then(b=>{a({token:b}).then(a=>{console.log(a),location.assign(a.data)}).catch(a=>{console.error(a)})}).catch(a=>{console.error(a)})}})(),(()=>{var a=document.querySelector("#xu-cl-xcstats-loginButton"),b=document.querySelector("#xu-cl-strava-loginButton");firebase.auth().onAuthStateChanged(()=>{firebase.auth().currentUser||location.assign("..");var c=document.querySelector("#xu-cl-loginFlow"),d=document.querySelector("#xu-cl-main");firebase.firestore().doc("users/"+firebase.auth().currentUser.uid).get().then(e=>{var f=e.data();console.log(f),f&&f["markers.hasLoggedInWithXCStats"]&&!0==f["markers.hasLoggedInWithXCStats"].status&&f["markers.hasLoggedInWithStrava"]&&!0==f["markers.hasLoggedInWithStrava"].status||location.search.includes("stravaAuthSucceeded")?(a.disabled=!0,b.disabled=!0,d.classList.remove("d-none"),mainBlock.startMainBlock()):f&&f["markers.hasLoggedInWithXCStats"]&&!0==f["markers.hasLoggedInWithXCStats"].status?(a.disabled=!0,b.disabled=!1,c.classList.remove("d-none")):c.classList.remove("d-none")}).catch(a=>console.error(a))})})();var mainBlock=(()=>{var a=Math.floor,b=function(a){var b=document.createElement("div");return b.innerHTML=a.trim(),b.firstChild};return{startMainBlock:()=>{var c=firebase.functions().httpsCallable("downloadStravaActivities"),d=firebase.functions().httpsCallable("getTwoWeeksOfLogs"),e=document.querySelector("#xu-cl-stravaDownloadingHeader"),f=document.querySelector("#xu-cl-stravaActivitiesList"),g=document.querySelector("#xu-cl-activitiesSummary");e.classList.remove("d-none"),g.classList.add("d-none");var h=document.querySelector("#template-day").innerHTML,i=document.querySelector("#template-activity").innerHTML;d({date:new Date}).then(d=>{d=d.data,console.log(d);for(var j=[].slice.call(document.querySelectorAll(".xu-logDisplay .xu-logDisplay-contentRow .col:not([class*=xu-hh])")),k=0;7>k;k++){var l=j[k+7],m=j[k];console.log(d.lastWeekLog[k].log),console.log(l,m);var n=[d.lastWeekLog[k].log.reduce((a,b)=>a+b,0),d.thisWeekLog[k].log.reduce((a,b)=>a+b,0)];[l,m].forEach((a,b)=>{a.style.backgroundColor=0==n[b]?"#FFF":1==n[b]?"#888":"#000",a.innerText=0==n[b]?"0":1==n[b]?"1":"2"})}var o=[],p={};[d.lastWeekLog,d.thisWeekLog].forEach(a=>{a.forEach(a=>o.push(a))}),o=o.map(a=>{var b=new Date(a.date),c=(b.getMonth()+1+"").padStart(2,"0")+"/"+(b.getDate()+"").padStart(2,"0")+"/"+(b.getYear()+1900);return a.date=c,a}).forEach(a=>{console.log(a),p[a.date]=a.log.reduce((a,b)=>a+b,0)}),console.log(p),c().then(c=>{var d={},j=c.data;console.log(j),j.forEach(a=>{var b=new Date(a.date),c=(b.getMonth()+1+"").padStart(2,"0")+"/"+(b.getDate()+"").padStart(2,"0")+"/"+(b.getYear()+1900);d[c]?d[c].push(a):d[c]=[a]});var k="";for(var l in d){var m=d[l];k+=h.replace(/%date%/g,l).replace(/%activities%/g,m.map(c=>{var d=b(i.replace(/%title%/g,c.title).replace(/%summary%/g,"distance: "+c.distance.toFixed(1)+" miles ; moving time: "+a(c.movingTime/60)+" minutes and "+(c.movingTime%60+"").padStart(2,"0")+" seconds").replace(/%type%/g,c.type).replace(/%url%/g,"https://strava.com/activities/"+c.id).replace(/%disabled%/g,2==p[l]?"disabled":""));return console.log(d),d.querySelector(".selectorBox").setAttribute("data-activitydata",JSON.stringify({date:l,activity:c})),d.outerHTML}).join(""))}f.innerHTML=k,e.classList.add("d-none"),g.classList.remove("d-none");var n=[],o=()=>{0==n.length?[].slice.call(document.querySelectorAll(".addBox")).forEach(a=>{a.disabled=!0,a.classList.add("invisible")}):(document.querySelector(".addBox[data-date='"+n[0].date+"']").classList.remove("invisible"),document.querySelector(".addBox[data-date='"+n[0].date+"']").disabled=!1)};[].slice.call(document.querySelectorAll(".addBox")).forEach(a=>{a.onclick=a=>{a.preventDefault(),uploadBlock.startUploadBlock(n,p)}}),[].slice.call(document.querySelectorAll(".selectorBox[data-activitydata]")).forEach(a=>{var b=!1,c=JSON.parse(a.getAttribute("data-activitydata"));a.onclick=d=>{if(d.preventDefault(),!b){console.log(n,p);var e=!1;0==n.length?(n.push(c),e=!0):n[0].date==c.date&&n[0].activity.type==c.activity.type&&(n.push(c),e=!0),console.log(e),e?(b=!0,o(),a.classList.remove("btn-outline-primary"),a.classList.add("btn-outline-success"),a.innerText="Selected"):(a.classList.remove("btn-outline-primary"),a.classList.add("btn-outline-danger"),a.innerText="Cannot Select",setTimeout(()=>{a.classList.add("btn-outline-primary"),a.classList.remove("btn-outline-danger"),a.innerText="Select"},500))}else{b=!1,a.classList.add("btn-outline-primary"),a.classList.remove("btn-outline-success"),a.innerText="Select";var f=-1;if(n.forEach((a,b)=>{a==c&&(f=b)}),-1==f)return;n.splice(f,1),o()}}})}).catch(a=>console.error(a))}).catch(a=>console.error(a))}}})(),uploadBlock=(()=>({startUploadBlock:(a,b)=>{var c=Math.floor,d=document.querySelector("#xu-uploadForm"),e=document.querySelector("#xu-uploadInterface"),f=document.querySelector("#xu-cl-main"),g={$cancelButton:"xu-cancelUploadButton",$error:"xu-upload-error",$title:"xu-upload-title",$distance:"xu-upload-distance",$time:"xu-upload-time",$description:"xu-upload-description",$effortGroup:"xu-upload-effortGroup",$feelGroup:"xu-upload-feelGroup",$submitButton:"xu-upload-submitButton",$success:"xu-upload-success"},h=()=>{console.log("packing up"),g.$submitButton.disabled=!1,g.$success.classList.add("d-none"),[g.$effortGroup,g.$feelGroup].forEach(a=>{a.removeAttribute("data-selected"),[].slice.call(a.children).forEach(a=>a.classList.remove("active"))}),f.classList.remove("d-none"),mainBlock.startMainBlock(),e.classList.add("d-none")};for(var i in g)g[i]=document.getElementById(g[i]);g.$cancelButton.onclick=h,console.log(g.$cancelButton,h);var j=firebase.functions().httpsCallable("postToXCStats"),k=a[0].date;console.log(a,b[k]);var l=a;if(l&&0!=l.length){var k=l[0].date,m=l[0].activity.type,n=m;n+=1==l.length?" - "+l[0].activity.title:" - "+k;var o=l.map(a=>"https://strava.com/activities/"+a.activity.id+"\n\n"),p=l.reduce((a,b)=>a+b.activity.distance,0),q=l.reduce((a,b)=>a+b.activity["movingTime"],0),r=c(q/60),s=c(q%60);g.$title.value=n,g.$distance.innerText=p.toFixed(1)+"mi",g.$time.innerText=r+":"+(s+"").padStart(2,"0"),g.$description.value=o,f.classList.add("d-none"),e.classList.remove("d-none"),[g.$effortGroup,g.$feelGroup].forEach(function(a){var b=[].slice.call(a.children);console.log(b),b.forEach((c,d)=>{c.onclick=()=>{b.forEach(a=>a.classList.remove("active")),c.classList.add("active"),a.setAttribute("data-selected",d)}})});var t=a=>{g.$error.classList.remove("d-none"),g.$error.innerText="Could not submit because "+a,g.$submitButton.disabled=!1};d.onsubmit=a=>{if(a.preventDefault(),g.$error.classList.add("d-none"),g.$submitButton.disabled=!0,""==g.$title.value)return t("the title is blank.");if(!g.$effortGroup.hasAttribute("data-selected"))return t("there is no effort level selected.");if(!g.$feelGroup.hasAttribute("data-selected"))return t("there is no runner feel selected.");var c={recordIndex:b[k],title:g.$title.value,date:k,minutes:r,seconds:s,distance:p.toFixed(1),effort:parseInt(g.$effortGroup.getAttribute("data-selected"))+1,runnerFeel:parseInt(g.$feelGroup.getAttribute("data-selected"))+1,description:g.$description.value};console.log(JSON.stringify(c)),j({payload:c}).then(a=>{console.log(a),a.data.includes("success:::")&&(g.$success.classList.remove("d-none"),setTimeout(()=>h(),1e3))}).catch(a=>t(a))},console.log(p.toFixed(1),q,r,s)}}}))();